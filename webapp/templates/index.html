<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>Al-Azhar &amp; Dirassa WebApp</title>
    <link rel="preconnect" href="https://telegram.org" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="stylesheet" href="{{ request.app.url_path_for('webapp_static', path='css/main.css') }}?v={{ version }}">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body data-mode="{{ mode }}">
    <div id="app" class="app-shell">
        <header class="app-header">
            <div class="app-title-row">
                <div>
                    <h1 class="app-title">Al-Azhar &amp; Dirassa</h1>
                    <p class="app-subtitle">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram</p>
                </div>
                <div class="app-header-meta" aria-live="polite">
                    <span id="modeBadge" class="mode-badge">{{ '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º' if mode == 'user' else '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }}</span>
                    <button id="adminToggleButton" class="mode-toggle hidden" type="button" aria-pressed="false">
                        <span class="mode-toggle-label">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
                    </button>
                    <span class="version-chip" id="versionChip">v{{ version }}</span>
                </div>
            </div>
        </header>

        <nav class="floating-category-bar" aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–º–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)">
            <div id="floatingCategoryList" class="floating-category-bar-inner"></div>
        </nav>

        <div class="layout">
            <aside class="category-sidebar" aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <p class="sidebar-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
                    <nav id="categoryList" class="category-list" aria-label="–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π"></nav>
                </div>
            </aside>

            <main class="content-area">
                <nav id="breadcrumbs" class="breadcrumbs" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"></nav>

                <section id="categoryHero" class="category-hero hidden" aria-hidden="true"></section>

                <section class="content-header" aria-live="polite">
                    <h2 id="categoryTitle" class="category-heading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</h2>
                    <p id="categoryDescription" class="category-intro"></p>
                    <span id="categoryMeta" class="category-meta"></span>
                </section>

                <section id="loadingState" class="loading" role="status" aria-live="assertive" hidden>
                    <div class="spinner" aria-hidden="true"></div>
                    <p class="loading-text">–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç...</p>
                </section>

                <section id="errorState" class="error hidden" role="alert" aria-live="assertive">
                    <p class="error-title">‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>
                    <p id="errorMessage" class="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>
                    <button id="retryButton" class="retry-button" type="button">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                </section>

                <div id="emptyState" class="empty-state hidden" role="status" aria-live="polite">
                    <div class="empty-icon" aria-hidden="true">üì≠</div>
                    <p class="empty-text">–ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–π–¥–∏—Ç–µ –ø–æ–∑–∂–µ.</p>
                </div>

                <section id="contentItems" class="content-items" aria-live="polite"></section>

                <!-- Admin Toolbar -->
                <div id="adminToolbar" class="admin-toolbar hidden">
                    <button id="addCategoryBtn" class="admin-btn admin-btn-primary" type="button">
                        <span class="admin-btn-icon">+</span> –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>
                    <button id="editCategoryBtn" class="admin-btn admin-btn-secondary" type="button" disabled>
                        <span class="admin-btn-icon">‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>
                    <button id="addItemBtn" class="admin-btn admin-btn-secondary" type="button" disabled>
                        <span class="admin-btn-icon">+</span> –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
                    </button>
                    <button id="manageCategoriesBtn" class="admin-btn admin-btn-secondary" type="button">
                        <span class="admin-btn-icon">üìã</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- Admin Category Panel -->
    <div id="adminCategoryPanel" class="admin-panel hidden" role="dialog" aria-modal="true" aria-labelledby="categoryPanelTitle">
        <div class="admin-panel-overlay"></div>
        <div class="admin-panel-content">
            <div class="admin-panel-header">
                <h3 id="categoryPanelTitle" class="admin-panel-title">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <button class="admin-panel-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="admin-panel-body">
                <form id="categoryForm" class="admin-form">
                    <input type="hidden" id="categoryId" name="id">
                    
                    <div class="form-group">
                        <label for="categorySlug">Slug (URL)</label>
                        <input type="text" id="categorySlug" name="slug" required>
                        <small class="form-help">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∞—Ç–∏–Ω–∏—Ü—É, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã. –ù–∞–ø—Ä–∏–º–µ—Ä: about-us</small>
                    </div>

                    <div class="form-group">
                        <label for="categoryTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="categoryTitle" name="title" required>
                    </div>

                    <div class="form-group">
                        <label for="categoryDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="categoryDescription" name="description" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="categoryCoverFileId">–û–±–ª–æ–∂–∫–∞</label>
                        <div class="file-input-group">
                            <input type="number" id="categoryCoverFileId" name="cover_file_id" placeholder="ID —Ñ–∞–π–ª–∞ –æ–±–ª–æ–∂–∫–∏">
                            <button type="button" id="uploadCoverBtn" class="btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="categoryIsActive" name="is_active" checked>
                            –ê–∫—Ç–∏–≤–Ω–∞
                        </label>
                    </div>

                    <div class="admin-form-actions">
                        <button type="submit" class="admin-btn admin-btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="admin-btn admin-btn-secondary" id="cancelCategoryBtn">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Item Panel -->
    <div id="adminItemPanel" class="admin-panel hidden" role="dialog" aria-modal="true" aria-labelledby="itemPanelTitle">
        <div class="admin-panel-overlay"></div>
        <div class="admin-panel-content">
            <div class="admin-panel-header">
                <h3 id="itemPanelTitle" class="admin-panel-title">–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</h3>
                <button class="admin-panel-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="admin-panel-body">
                <form id="itemForm" class="admin-form">
                    <input type="hidden" id="itemId" name="id">
                    <input type="hidden" id="itemCategoryId" name="category_id">

                    <div class="form-group">
                        <label for="itemType">–¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞</label>
                        <select id="itemType" name="type" required>
                            <option value="TEXT">–¢–µ–∫—Å—Ç</option>
                            <option value="IMAGE">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
                            <option value="DOCUMENT">–î–æ–∫—É–º–µ–Ω—Ç</option>
                            <option value="VIDEO">–í–∏–¥–µ–æ</option>
                            <option value="LINK">–°—Å—ã–ª–∫–∞</option>
                            <option value="BUTTON">–ö–Ω–æ–ø–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</option>
                        </select>
                    </div>

                    <div class="form-group" id="itemTextContentGroup">
                        <label for="itemTextContent">–¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</label>
                        <textarea id="itemTextContent" name="text_content" rows="5"></textarea>
                    </div>

                    <div class="form-group hidden" id="itemFileGroup">
                        <label for="itemFileId">–§–∞–π–ª</label>
                        <div class="file-input-group">
                            <input type="number" id="itemFileId" name="file_id" placeholder="ID —Ñ–∞–π–ª–∞">
                            <button type="button" id="uploadItemFileBtn" class="btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
                        </div>
                    </div>

                    <div class="form-group hidden" id="itemButtonGroup">
                        <label for="itemButtonText">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
                        <input type="text" id="itemButtonText" name="button_text">
                    </div>

                    <div class="form-group hidden" id="itemTargetGroup">
                        <label for="itemTargetCategoryId">–¶–µ–ª–µ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="itemTargetCategoryId" name="target_category_id">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="itemIsActive" name="is_active" checked>
                            –ê–∫—Ç–∏–≤–µ–Ω
                        </label>
                    </div>

                    <div class="admin-form-actions">
                        <button type="submit" class="admin-btn admin-btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="admin-btn admin-btn-secondary" id="cancelItemBtn">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Manage Categories Panel -->
    <div id="manageCategoriesPanel" class="admin-panel hidden" role="dialog" aria-modal="true" aria-labelledby="manageCategoriesTitle">
        <div class="admin-panel-overlay"></div>
        <div class="admin-panel-content">
            <div class="admin-panel-header">
                <h3 id="manageCategoriesTitle" class="admin-panel-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
                <button class="admin-panel-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="admin-panel-body">
                <div id="categoriesList" class="admin-list"></div>
            </div>
        </div>
    </div>

    <!-- File Upload Panel -->
    <div id="fileUploadPanel" class="admin-panel hidden" role="dialog" aria-modal="true" aria-labelledby="fileUploadTitle">
        <div class="admin-panel-overlay"></div>
        <div class="admin-panel-content">
            <div class="admin-panel-header">
                <h3 id="fileUploadTitle" class="admin-panel-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</h3>
                <button class="admin-panel-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="admin-panel-body">
                <form id="fileUploadForm" class="admin-form">
                    <div class="form-group">
                        <label for="fileInput">–§–∞–π–ª</label>
                        <input type="file" id="fileInput" name="file" required accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt">
                    </div>

                    <div class="form-group">
                        <label for="fileDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="fileDescription" name="description">
                    </div>

                    <div class="form-group">
                        <label for="fileTag">–¢–µ–≥</label>
                        <input type="text" id="fileTag" name="tag">
                    </div>

                    <div class="admin-form-actions">
                        <button type="submit" class="admin-btn admin-btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        <button type="button" class="admin-btn admin-btn-secondary" id="cancelFileUploadBtn">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <h4 id="confirmTitle" class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h4>
            <p id="confirmMessage" class="modal-message"></p>
            <div class="modal-actions">
                <button id="confirmYes" class="admin-btn admin-btn-primary" type="button">–î–∞</button>
                <button id="confirmNo" class="admin-btn admin-btn-secondary" type="button">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="imageModal" class="modal" role="dialog" aria-modal="true" aria-label="–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <div class="modal-content">
            <button id="modalCloseButton" class="modal-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            <img id="modalImage" class="modal-image" src="" alt="–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        </div>
    </div>

    <script id="webapp-config" type="application/json">{{ config | tojson }}</script>
    <script type="module" src="{{ request.app.url_path_for('webapp_static', path='js/app.js') }}?v={{ version }}" defer></script>
</body>
</html>
